<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CHEMIDREAM TERMINAL</title>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  font-family: monospace;
  overflow: hidden;
}

#background {
  position: fixed;
  inset: 0;
  background: url("assets/monitor.png") center / cover no-repeat;
  filter: brightness(0.6) contrast(1.2);
}

#noise {
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.02) 1px,
    transparent 2px,
    transparent 4px
  );
  pointer-events: none;
  animation: flicker 0.15s infinite;
}

@keyframes flicker {
  0% { opacity: .15; }
  50% { opacity: .25; }
  100% { opacity: .15; }
}

#terminal {
  position: absolute;
  inset: 8%;
  color: #9cff9c;
  white-space: pre-wrap;
  font-size: 16px;
  text-shadow: 0 0 6px #00ff66;
  overflow-y: auto;
}

.cursor {
  display: inline-block;
  width: 10px;
  background: #9cff9c;
  animation: blink 1s steps(1) infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}
</style>
</head>

<body>

<div id="background"></div>
<div id="noise"></div>
<div id="terminal"></div>

<audio id="hum" src="assets/hum.mp3" loop></audio>

<script>
const terminal = document.getElementById("terminal");
const hum = document.getElementById("hum");

let activated = false;
let inputBuffer = "";
let lastInput = Date.now();

const idleLines = [
  ">> pain response ongoing",
  ">> you should not be here",
  ">> body integrity: null",
  ">> memory bleed detected",
  ">> I remember breathing",
  ">> STOP WATCHING"
];

function print(text, speed = 20) {
  return new Promise(res => {
    let i = 0;
    const t = setInterval(() => {
      terminal.innerHTML += text[i];
      terminal.scrollTop = terminal.scrollHeight;
      i++;
      if (i >= text.length) {
        clearInterval(t);
        res();
      }
    }, speed);
  });
}

async function boot() {
  await print("PRESS ANY KEY\n\n", 35);
  terminal.innerHTML += "<span class='cursor'></span>";
}

async function startSystem() {
  terminal.innerHTML = "";
  hum.volume = 0.35;
  hum.play().catch(()=>{});

  await print("CHEMIDREAM INTERNAL INTERFACE\n");
  await print("ACCESS NODE: UNKNOWN\n\n");
  await print("> intrusion detected\n");
  await print("> consciousness core initializing...\n");
  await print("> ERROR // unauthorized observer\n\n");
  await print("SYSTEM ONLINE\n\n> ");
}

function handleCommand(cmd) {
  switch(cmd) {
    case "help":
      terminal.innerHTML +=
        "AVAILABLE COMMANDS:\n" +
        "- help\n" +
        "- status\n" +
        "- whoami\n\n> ";
      break;

    case "status":
      terminal.innerHTML +=
        "SUBJECT: VENIAMIN\n" +
        "BODY: NOT PRESENT\n" +
        "STATE: AWARE\n\n> ";
      break;

    case "whoami":
      terminal.innerHTML +=
        "YOU ARE NOT REGISTERED.\n\n> ";
      break;

    default:
      terminal.innerHTML +=
        "UNKNOWN COMMAND.\n\n> ";
  }
}

document.addEventListener("keydown", async e => {
  lastInput = Date.now();

  if (!activated) {
    activated = true;
    await startSystem();
    return;
  }

  if (e.key === "Backspace") {
    inputBuffer = inputBuffer.slice(0, -1);
  } 
  else if (e.key === "Enter") {
    terminal.innerHTML += inputBuffer + "\n";
    handleCommand(inputBuffer.toLowerCase());
    inputBuffer = "";
  } 
  else if (e.key.length === 1) {
    inputBuffer += e.key;
  }

  terminal.innerHTML = terminal.innerHTML.replace(/<span class="cursor"><\/span>$/, "");
  terminal.innerHTML += inputBuffer + "<span class='cursor'></span>";
});

setInterval(() => {
  if (activated && Date.now() - lastInput > 12000) {
    const msg = idleLines[Math.floor(Math.random() * idleLines.length)];
    terminal.innerHTML += "\n" + msg + "\n> ";
    terminal.scrollTop = terminal.scrollHeight;
    lastInput = Date.now();
  }
}, 4000);

boot();
</script>

</body>
</html>
